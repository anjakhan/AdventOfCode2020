const input = [{mask: '10X0110X01100X00111XX00001X011101001', mem: [[45673, 370803],[32234, 92667525],[47600, 955],[6610, 316949]]}, {mask: '0X10X001X00011X1111X111111010100X000', mem: [[13551, 903991],[45894, 160707],[4188, 64891428],[43779, 4687114],[51764, 53700515]]}, {mask: '01X0X0001X10XX1001001111X0101111010X', mem: [[34881, 3311],[23766, 26540481],[4785, 13080077],[43617, 238523796]]}, {mask: '010X100X010000101X100101011X0110X00X', mem: [[4166, 16195],[21001, 622],[13952, 245],[43083, 105622],[11083, 8400],[35492, 48568]]}, {mask: 'X100X00XX1100X111111001001000X00X110', mem: [[50918, 9999],[59535, 70467],[20502, 87635],[57441, 113],[21256, 398644],[43258, 307]]}, {mask: '1000XX00X1100X0XXX1110010X1001101001', mem: [[14095, 944],[12960, 7270083],[666, 4745792],[43494, 702],[55637, 86020085],[61142, 10437888]]}, {mask: '11101XX01110X11011011101XX0100X0100X', mem: [[57379, 4533],[48229, 15994],[22693, 1881],[44857, 286865340],[17331, 8492087],[25889, 1613193]]}, {mask: '0000100X0110X1111X0X11X00000X10XX1X1', mem: [[57477, 6196148],[6101, 15304384],[57864, 200431]]}, {mask: '000X1X0001X0111X1111001000X0101011X0', mem: [[44569, 3960],[39386, 4949396],[9324, 96252],[10664, 3252],[33233, 50858274],[41081, 203824750],[6645, 34497265]]}, {mask: '000011010010111X11111X00010X1100011X', mem: [[3293, 233493759],[18956, 118389],[1025, 5036522]]}, {mask: '10X0X0X0011001X111111X01X110001X0XX0', mem: [[4097, 107862],[6873, 2097]]}, {mask: '0100100XX1100X111111X001010111X01100', mem: [[61230, 540498103],[47962, 2753],[37400, 2327554],[30629, 1110830],[53020, 5591877]]}, {mask: '10100X000101111X111X0X001110X0000101', mem: [[54388, 26326],[419, 1567],[5373, 2530],[60258, 33744]]}, {mask: 'X1101000X11011X0110X1X0X000X0010X0X1', mem: [[54088, 256796],[38615, 38356],[40164, 31653],[21378, 76110],[33233, 277981788],[2571, 133984535],[11562, 879]]}, {mask: '1X000X00010101011X10110X11111001XX11', mem: [[34740, 8869920],[22740, 521027],[33792, 96794],[37005, 862607],[22723, 317832765],[26555, 20923879],[22410, 54159]]}, {mask: '00X010XX11101111X1111X0X1X000111X001', mem: [[26275, 663],[59230, 226183705],[41684, 2128],[54297, 12877801],[60773, 376426529],[20303, 196221024]]}, {mask: '101X1000X1X10101111X11X0X110010100XX', mem: [[22528, 16249],[57494, 279620437],[58026, 31278],[37016, 4312],[9883, 921],[41007, 1465898],[40481, 1671783]]}, {mask: '0X0X100001X01X10111X0X01000110101101', mem: [[10406, 997],[38062, 59582680],[10708, 198003209],[46873, 408862],[11077, 459424361],[5727, 1700448],[14726, 2676553]]}, {mask: '10101X10011X000X101X0111X10X1000X0X1', mem: [[10664, 1516],[30273, 75130511],[35601, 25120037],[49009, 1173]]}, {mask: '0X00100001101X1110010100X0001XX001X1', mem: [[49285, 7571],[64534, 1098],[32768, 200634491]]}, {mask: '0000100X01100X101101X110X0X011110100', mem: [[22416, 30148149],[60551, 149806],[2296, 213850419],[41081, 39093],[27329, 216373847]]}, {mask: '0X00100011X0001011000XX1011001011101', mem: [[18054, 9320576],[54549, 890],[41636, 251377782],[2838, 33263103],[17995, 30197595]]}, {mask: '01X1100X1X10011001XXX0000X0011010010', mem: [[49674, 40088568],[13699, 9623301],[17255, 102507],[1482, 950983],[25007, 209244],[49349, 6079]]}, {mask: '00X011X1X0001101XX10010XX01111000001', mem: [[5196, 30458917],[50829, 8251485]]}, {mask: '010X1000X1100X10XX0X010X000011X10X01', mem: [[32774, 10963415],[41684, 371254],[5706, 6352],[57962, 1978534],[8949, 573680]]}, {mask: '000010010X11X1X1X11X00X00X00X110110X', mem: [[60127, 25613364],[54388, 5567],[1653, 1153],[49977, 2608790],[9352, 121392208]]}, {mask: '101000X0011001111X11000XX01000000001', mem: [[54320, 11715],[26597, 1278105],[34204, 6005345]]}, {mask: '100X000100001111111001X1010X0111100X', mem: [[17355, 75752606],[53353, 41600],[45075, 4191461]]}, {mask: '000X0X0X0000111111101X000101XXX0110X', mem: [[27128, 1953],[17909, 1884792],[51151, 161966299],[60933, 477409],[39509, 502]]}, {mask: '10X0100001X10001001001X10101010100X0', mem: [[26096, 7205],[39089, 53634109],[3545, 339663043]]}, {mask: '01X01X00011X00X01X0011X1001001X10011', mem: [[34827, 1959],[22616, 29090401],[37561, 18]]}, {mask: '11XX100X0X10110011011101000100000001', mem: [[57541, 2764656],[39464, 945],[34491, 42267],[56023, 6588],[59338, 227140650],[8359, 3521567],[41266, 2122]]}, {mask: 'XX00XX00011000101XXX0101XX0001100111', mem: [[21001, 467174080],[40395, 368280],[21797, 32584],[51282, 6472405],[21479, 38767],[35943, 1352511]]}, {mask: '0X000001X0X0X11111X0111000111XX00101', mem: [[19657, 22615287],[26805, 864204812],[42351, 5662],[2495, 43866067],[52318, 1650]]}, {mask: '0000X0X00X1001111101X11X010XX1010101', mem: [[54816, 774],[18176, 2028911],[24777, 8250958]]}, {mask: 'X0001X0X0X1011111111X1000X0011000111', mem: [[40738, 2113],[32774, 484919091],[39152, 628235],[54496, 5964],[40103, 7433792]]}, {mask: '0101100XX010X110011100000X00X0000X11', mem: [[17488, 3678],[22963, 519281],[36751, 85353835],[47241, 2092837]]}, {mask: '00X0000100101111X11X00X0111XX1XX10X1', mem: [[1650, 922793],[41636, 6071583],[36791, 722],[45902, 372891111]]}, {mask: '0001X1X01110011X010X001110X10001X00X', mem: [[15382, 246575660],[10047, 2031],[33628, 11165],[59682, 71030]]}, {mask: 'XX01100010X001100X11X0X11X00100011X1', mem: [[1239, 750],[7827, 242729],[2838, 10048934],[40971, 531387],[26539, 9562],[10664, 1779885]]}, {mask: 'X0X000X0011101XX1111011100000100X011', mem: [[13229, 118094981],[22915, 127258],[57384, 2073],[18067, 44857],[1653, 149132182],[17291, 395470]]}, {mask: '00XX100101100X11X1X00000001010010101', mem: [[31462, 3975909],[49220, 466696245],[50776, 887],[48644, 241048]]}, {mask: '0100X000X100XX111111X010010110011100', mem: [[29775, 441],[52222, 5446718]]}, {mask: '101010X001XX01111011010101010100010X', mem: [[16127, 264083],[27345, 5194478],[26269, 167664051],[34669, 802625]]}, {mask: '0100100001X00X1111110XX00X00X00101X0', mem: [[21223, 48966793],[55118, 225912],[29898, 1032],[34679, 318500],[18584, 5184511],[53788, 381219]]}, {mask: '00000001001011XX11100000X100X0101001', mem: [[20373, 668],[16238, 532704],[19062, 680735783],[57683, 382],[64534, 305874],[29567, 71891],[55384, 8257807]]}, {mask: '010010000110011X10XXX1011011X0010011', mem: [[8834, 27346290],[26882, 5857155],[65399, 28233],[15313, 9758],[19856, 15131],[21792, 452232]]}, {mask: 'X0100X000110011111110X0X01XX100111X1', mem: [[36885, 11870],[23633, 8017694],[49960, 59066]]}, {mask: '000010010X10011X110X11010X1100011101', mem: [[52222, 7906],[50113, 20025],[62759, 60742],[42818, 24123],[20196, 2695677],[56150, 2043641]]}, {mask: '000010X10010011111110000XX1X01101101', mem: [[14726, 163931507],[64534, 10658257],[36548, 2016635],[53328, 1547],[37016, 29161],[49509, 204],[54816, 133927223]]}, {mask: 'X000X000011X0101111111X00X00X000X011', mem: [[63137, 65851],[3078, 46729269],[28777, 44750],[8050, 2134]]}, {mask: '0010100XX000X1011XX00101011001000110', mem: [[42058, 1405824],[56633, 3470500],[18390, 40628]]}, {mask: '0100X00X01100X10100XX100011000X00011', mem: [[23954, 26996858],[42351, 4571897],[39152, 5572],[22233, 1518947],[3293, 261]]}, {mask: '10X010X00111011X1110111011X000X10001', mem: [[10419, 119957],[64222, 1935417],[39073, 7184]]}, {mask: '00001000111001101001XX10XX00X00X011X', mem: [[18840, 6949],[54130, 31279452],[56463, 2468673],[12291, 94799059],[31014, 130]]}, {mask: '0100100X11X000X011010X0X0X00110011X1', mem: [[55653, 780405166],[17373, 289755],[55275, 129895]]}, {mask: 'X0001XX001110111101001X10100X0010010', mem: [[61610, 176605034],[26181, 1694],[40235, 249848880],[65399, 58927],[4769, 197080137],[2885, 88722]]}, {mask: '010110X011X001X10100010X110111010011', mem: [[19697, 49908],[49644, 27297],[46331, 68362],[23374, 4476652],[38046, 152384]]}, {mask: '01001000X1X000X01X100X00XX00010010X0', mem: [[57824, 238363421],[13229, 141760722],[12259, 67177],[24101, 3496418],[38370, 125455],[49997, 1619802]]}, {mask: 'X0XX1001X0X111110111110X10100X0110X0', mem: [[57151, 27210],[51757, 94709766],[27009, 184467],[65310, 623337],[8310, 6432],[42814, 312612328]]}, {mask: '000X11X0X1100110X10X00X1X0X100001X01', mem: [[51449, 233840],[33113, 336176],[24215, 583439],[32484, 33697151],[41246, 35091190],[45335, 22504209]]}, {mask: '00001X01XX00110111101000X11001000X00', mem: [[49728, 385],[20071, 19552156],[36751, 1381732],[63977, 140878],[40754, 8924389],[31910, 4771465]]}, {mask: '0X101XX0111011101101101100XXX1X11111', mem: [[4561, 86501812],[45894, 15097769],[52368, 10598],[57151, 17927388],[39781, 121000932]]}, {mask: '1X00X000XX10010111111101X00001X0000X', mem: [[40963, 13692],[44259, 12653]]}, {mask: '00X010000XX011111100100X001100010001', mem: [[26454, 7079],[23082, 1849],[16238, 112603],[35527, 3215051]]}, {mask: '01X0100XX110XX10110X1X0100001100X0X1', mem: [[22233, 14653],[65020, 210017],[52710, 3469],[4243, 4204979]]}, {mask: '00001100001X11110111001000X00000X10X', mem: [[54906, 160425],[2296, 107308],[25636, 325676],[1157, 17126],[18174, 26645399],[341, 134]]}, {mask: '00001X0X0X1X1111X111000001000XX01100', mem: [[49509, 1792437],[9352, 16691097]]}, {mask: '01011000X110011010010XX00XX0X10X0000', mem: [[47744, 66265],[17758, 2364],[58881, 184736586],[45874, 3288],[33128, 1060635188],[32851, 8162],[4758, 8270611]]}, {mask: '101010X0X1110X011010010111010X0100X1', mem: [[65020, 3436],[7304, 351967],[20204, 7690],[52050, 6767],[42627, 18681018],[2302, 309]]}, {mask: '0X00X00111101111XX11111X100X011X0100', mem: [[31161, 4045],[44948, 998036],[6417, 1038591],[19456, 331767],[13551, 351590897],[57397, 2335810],[27468, 30148246]]}, {mask: 'X0X010000111010111X10X011X0100110100', mem: [[26334, 2474013],[17909, 9019],[7685, 31],[31203, 88097]]}, {mask: '0101100XX1XX011X01XX1100000X0011X101', mem: [[33782, 10039109],[36350, 13839],[17355, 5492]]}, {mask: 'X000X00X110011111111X001110X001000X1', mem: [[65020, 81625042],[34391, 24765],[22616, 6081],[40777, 5659]]}, {mask: '10X01000011101X11X1XX101010X00X1X0X1', mem: [[57202, 334564],[64222, 2096644],[24034, 23828772],[22410, 146958],[10664, 57410819],[40103, 335],[40501, 115314]]}, {mask: '0X000001001011X1111111011010000010XX', mem: [[20666, 6659411],[44873, 41558959],[33233, 1051981],[51278, 6138],[36171, 1332906],[6568, 230],[40776, 4041579]]}, {mask: '10101000110101011111100X10000X00XX10', mem: [[11862, 14638],[18132, 998819],[11967, 360999],[6417, 655336840]]}, {mask: 'X0X10X010X001111X11010000001000101X0', mem: [[21289, 3642],[45673, 19810371],[1416, 92975839]]}, {mask: 'XX00100001100X111X110010000010001011', mem: [[51270, 25149],[42395, 132570],[1016, 1001728],[41825, 2500361],[17518, 608172],[41081, 59823249],[42445, 47]]}, {mask: '010X10001110001000000100X0X0110X00X0', mem: [[53475, 11095],[33113, 267232],[29075, 982]]}, {mask: '1010XX00XXX1X111111X00011100X00100X1', mem: [[22184, 3304995],[52883, 286206091],[17684, 3033221],[10660, 834092],[639, 66342],[10379, 615664],[47839, 1155259]]}, {mask: '00001X010110111110011X000X00100001XX', mem: [[53353, 219728],[65333, 4002063],[3492, 891],[6417, 6050475],[10047, 53027987],[57541, 37059],[29203, 79275]]}, {mask: '1X00X0X0011XX10X1110X0001010001X0X00', mem: [[56853, 3481],[48818, 70504232]]}, {mask: '000XX1X01110X1100100011110X010X0X010', mem: [[8087, 894158],[12413, 146584],[6706, 2582],[8095, 30280],[30578, 163689]]}, {mask: '0000X0X0011X00101010X10XX00001101XX1', mem: [[16238, 883],[60302, 1463],[52026, 501033],[21101, 963003],[49342, 37665]]}, {mask: '1000010X01X00XX010X01100110001100111', mem: [[21667, 384155],[54343, 6134066],[17373, 80965],[34043, 15468883],[855, 750],[3492, 4885002]]}, {mask: '1000X00001X10X01X0100X0111011101X001', mem: [[38410, 38053819],[64257, 7130584],[23001, 90831],[29203, 31460429]]}, {mask: '00X000X100101111X11XXX000110X10X0011', mem: [[53226, 3680],[43919, 7913],[23001, 113363252],[24130, 594]]}, {mask: 'X000X001XXX01111111X1101010X01X00001', mem: [[56633, 195050663],[45339, 58339099],[34669, 28208072],[33167, 107343266],[55625, 20752],[56130, 27956180]]}, {mask: '000011X00X0XX110111X001X10111010X00X', mem: [[10675, 342846],[1723, 1470723],[51218, 14886517],[25654, 468441],[22233, 750318],[10638, 1940647],[49663, 3527]]}, {mask: '00X0XX01X00011X1111011X0011X01X001X0', mem: [[21769, 95158],[18925, 465784126],[57920, 873],[29516, 1870546],[56132, 145637],[39089, 16016081],[40777, 111866962]]}, {mask: '0101100X111001X00100X10101001101001X', mem: [[46653, 282150006],[21001, 26649672]]}, {mask: '0000100X0X10X1X1111110X0X00X0000X1X1', mem: [[57539, 10584],[54889, 7790],[50184, 357116445],[8050, 8577]]}, {mask: '11000000011XX01011011101100000XX0111', mem: [[22120, 2547919],[64904, 493040],[17509, 411541],[6417, 7691463],[33118, 840]]}, {mask: '010010X001X00X111111011100X000X1X11X', mem: [[65020, 222328295],[30448, 4080],[52883, 592],[13763, 1508]]}, {mask: '010110X00110011X100001X0001001110X00', mem: [[44389, 839],[25975, 395854],[20373, 16016219],[23886, 68934677],[41201, 518],[17454, 738127],[56227, 806]]}, {mask: '00001X00X1100X101X010X11X0000X000111', mem: [[9822, 2044],[24640, 24948181],[24791, 7537],[39152, 2411],[18584, 348],[45337, 98555334],[53797, 31216158]]}, {mask: '0X0010000110011X11X101100XXXX1X001X1', mem: [[36788, 26899502],[57344, 9033077],[2296, 313866362],[57429, 96331601],[6101, 34417]]}, {mask: '0000X000011001101XX110110X1X011X0111', mem: [[50776, 68004929],[43617, 775267546],[60477, 1699097],[53328, 155946],[58881, 5866890],[19724, 24153]]}, {mask: '10000XX0010100011010011101X1010X1010', mem: [[1157, 392051],[32234, 43930],[3987, 213349],[17692, 467627],[42272, 5070]]}];

// Part 1

const getSumOfMemory = (input) => {
	let memIDs = [];
	input.map(item => item.mem.forEach(mem => memIDs.push(mem[0])));
	let memory = Array(Math.max(...memIDs)).fill(0);

	input.forEach(item => {
		const mask = item.mask;
		const mem = item.mem;
		let code = Array(mask.length).fill('0').join('');	
		
		for (x=0; x<mem.length; x++) {
			let str2 = Number(mem[x][1]).toString(2);
			let str1 = code.slice(0, code.length-str2.length);
			let value = str1.concat('', str2);

			for (i=0; i<mask.length; i++) {
				if (Number(mask[i]) === 1) value = value.substring(0, i) + 1 + value.substring(i + 1);
				if (Number(mask[i]) === 0) value = value.substring(0, i) + 0 + value.substring(i + 1);
			}

			index = mem[x][0];
			memory[index] = parseInt(value, 2);
		}
	});
	const reducer = (acc, value) => acc + value;
	return memory.reduce(reducer);
};

getSumOfMemory(input);

// ------------------------------------------------------------------------------------------------------------------------------------------------------

// Part 2

const getSumOfMemory2 = (input) => {
	let memIDs = [];
	input.map(item => item.mem.forEach(mem => memIDs.push(mem[0])));
	let memory = Array(Math.max(...memIDs)).fill(0);

	input.forEach(item => {
		const mask = item.mask;
		const mem = item.mem;
		let code = Array(mask.length).fill('0').join('');	
		
		for (x=0; x<mem.length; x++) {
			let str2 = Number(mem[x][0]).toString(2);
			let str1 = code.slice(0, code.length-str2.length);
			let value = str1.concat('', str2);

			for (i=0; i<mask.length; i++) {
				if (Number(mask[i]) === 1) value = value.substring(0, i) + 1 + value.substring(i + 1);
				if (mask[i] === 'X') value = value.substring(0, i) + 'X' + value.substring(i + 1);
			}
      
			const xArr = [...value.matchAll('X')].map(item => item.index);

			function zeroOneGen (dataArr, digits, index) {
			    let i, z;
			    let array = [];
			    if (index == digits) {
			        for (i = 0; i < digits; i++) {
			            value = value.substring(0, xArr[i]) + dataArr[i] + value.substring(xArr[i] + 1);
			        }
			        return;
			    }

			    for (z = 0; z < 2; z++) {
			        dataArr[index] = z;
			        zeroOneGen(dataArr, digits, index + 1);
			    }
			};

			let dataArrTemp = new Array(xArr.length);
			zeroOneGen(dataArrTemp, xArr.length, 0);

			index = parseInt(value, 2);
			memory[index] = mem[x][0];
		}
	});
	
	return memory.reduce((a, b) => a + b, 0);
};

getSumOfMemory2(input);
